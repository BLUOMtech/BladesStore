<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Blade Designs</title>
<style>
body{font-family:sans-serif;margin:0;background:#f6f6f6}
nav{position:sticky;top:0;background:#fff;padding:15px;box-shadow:0 2px 5px rgba(0,0,0,.1);display:flex;justify-content:space-between}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;padding:20px}
.card{background:#fff;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,.08);padding:15px;text-align:center}
.card img{width:100%;border-radius:10px}
button{padding:10px;border:none;border-radius:8px;background:#222;color:#fff;margin-top:8px;cursor:pointer}
#cart{position:fixed;right:0;top:0;width:320px;height:100%;background:#fff;box-shadow:-3px 0 8px rgba(0,0,0,.2);padding:20px;overflow:auto;transform:translateX(100%);transition:.3s}
#cart.open{transform:translateX(0)}
.box{background:#fafafa;padding:10px;border-radius:10px;margin-top:10px;font-size:14px}
#downloadsBox{display:none;padding:20px;background:#fff;margin:20px;border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,.1)}
#toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#222;color:#fff;padding:10px 20px;border-radius:8px;display:none;z-index:1000;}
</style>
</head>
<body>

<nav>
<b>Blade Designs</b>
<button onclick="toggleCart()">Cart (<span id="cartCount">0</span>)</button>
</nav>

<div id="shopPage">
  <div class="grid" id="shop"></div>
</div>

<div id="cart">
<h3>Your Cart</h3>
<div id="cartItems"></div>
<p><b>Total: $<span id="total">0</span></b></p>
<button onclick="checkout()">Checkout</button>

<div id="payBox" class="box" style="display:none">
  <h4>PayID Payment</h4>
  <p><b>PayID:</b> bladepeisker82@gmail.com</p>
  <p><b>Reference:</b> <span id="orderRef"></span></p>
  <p>Send payment, then click below:</p>
  <button onclick="placeOrder()">I Have Paid</button>
</div>
</div>

<div id="downloadsBox">
<h3>Your Digital Downloads</h3>
<div id="downloadLinks"></div>
</div>

<div id="toast"></div>

<script>
// ----- TOAST NOTIFICATIONS -----
function showToast(msg){
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.style.display="block";
  setTimeout(()=>{t.style.display="none";},3000);
}

// ----- CART -----
let cart = JSON.parse(localStorage.getItem("cart")||"[]");
function saveCart(){localStorage.setItem("cart",JSON.stringify(cart)); updateCartUI();}
function toggleCart(){document.getElementById("cart").classList.toggle("open");}

function updateCartUI(){
  document.getElementById("cartCount").innerText = cart.reduce((a,b)=>a+b.qty,0);
  let items="", total=0;
  cart.forEach(i=>{total+=i.price*i.qty; items+=`${i.title} x ${i.qty}<br>`;});
  document.getElementById("cartItems").innerHTML=items;
  document.getElementById("total").innerText=total;
}

function addToCart(p){
  let i=cart.find(x=>x.id===p.id);
  if(i)i.qty++; else cart.push({...p,qty:1});
  saveCart();
  showToast(`${p.title} added to cart`);
}

// ----- PRODUCTS -----
function getProducts(){return JSON.parse(localStorage.getItem("products")||"[]");}

function renderShop(){
  let html="";
  getProducts().forEach(p=>{
    html+=`
    <div class="card">
      <img src="${p.image}">
      <h4>${p.title}</h4>
      <p>$${p.price}</p>
      <button onclick='addToCart(${JSON.stringify(p)})'>Add to Cart</button>
    </div>`;
  });
  document.getElementById("shop").innerHTML=html;
}

// ----- CHECKOUT -----
function checkout(){
  if(cart.length===0){showToast("Cart is empty"); return;}
  const ref="ORDER-"+Date.now();
  document.getElementById("orderRef").innerText=ref;
  document.getElementById("payBox").style.display="block";
  localStorage.setItem("currentOrderRef",ref);
}

function placeOrder(){
  const orders=JSON.parse(localStorage.getItem("orders")||"[]");
  orders.push({
    ref: localStorage.getItem("currentOrderRef"),
    items: cart,
    paid:false,
    refunded:false
  });
  localStorage.setItem("orders",JSON.stringify(orders));
  showToast("Order placed! Give reference to the owner.");
  cart=[];
  saveCart();
  document.getElementById("payBox").style.display="none";
}

// ----- DOWNLOADS -----
function showDownloads(ref){
  const orders = JSON.parse(localStorage.getItem("orders")||"[]");
  const order = orders.find(o=>o.ref===ref && o.paid);
  if(!order) return; // don't show anything if not paid
  let html="";
  order.items.forEach(item=>{
    if(item.type==="digital"){
      let href = item.image.startsWith("data:") ? item.image : item.download;
      html+=`<a href="${href}" download="${item.title}"><button>Download ${item.title}</button></a><br><br>`;
    }
  });
  if(html){
    document.getElementById("downloadsBox").style.display="block";
    document.getElementById("downloadLinks").innerHTML=html;
  }
}

// ----- LIVE ORDER CHECK -----
setInterval(()=>{
  const currentRef=localStorage.getItem("currentOrderRef");
  if(currentRef) showDownloads(currentRef);
},2000);

// ----- INITIALIZE -----
renderShop();
updateCartUI();
</script>

</body>
</html>
