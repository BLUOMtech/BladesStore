<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Blade Designs â€“ Owner</title>
<style>
body{font-family:sans-serif;background:#f2f2f2;margin:0;padding:20px}
.box{background:#fff;padding:20px;border-radius:10px;max-width:600px;margin:auto;margin-top:40px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
input, select, textarea{width:100%;padding:10px;margin:5px 0;border-radius:8px;border:1px solid #ccc}
button{padding:10px;width:100%;border:none;border-radius:8px;background:#222;color:#fff;cursor:pointer;margin-top:5px}
.hidden{display:none}
.card{background:#fff;padding:10px;border-radius:10px;margin:10px 0}
#toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#222;color:#fff;padding:10px 20px;border-radius:8px;display:none;z-index:1000;}
</style>
</head>
<body>

<div id="loginBox" class="box">
  <h2>Owner Login</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="ownerPanel" class="hidden">
  <h2>Owner Panel</h2>
  <button onclick="logout()">Logout</button>

  <h3>Change Login Credentials</h3>
  <input id="newEmail" placeholder="New Email">
  <input id="newPass" type="password" placeholder="New Password">
  <button onclick="changeCredentials()">Change Login</button>

  <h3>Add/Edit Product</h3>
  <input id="prodId" type="hidden">
  <input id="title" placeholder="Title">
  <input id="price" type="number" placeholder="Price">
  <select id="type">
    <option value="physical">Physical</option>
    <option value="digital">Digital</option>
  </select>
  <input id="download" placeholder="Download path (for digital)">
  <input id="imageFile" type="file">
  <input id="imageURL" placeholder="Or enter image URL">
  <button onclick="saveProduct()">Save Product</button>

  <h3>Products</h3>
  <div id="productsList"></div>

  <h3>Orders</h3>
  <div id="ordersList"></div>
</div>

<div id="toast"></div>

<script>
// ----- TOAST NOTIFICATIONS -----
function showToast(msg){
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.style.display="block";
  setTimeout(()=>{t.style.display="none";},3000);
}

// ----- Simple Hasher -----
const BPhashIt = {
  hashit: function(str){
    let hash=0;
    for(let i=0;i<str.length;i++){
      hash=((hash<<5)-hash)+str.charCodeAt(i);
      hash|=0;
    }
    return hash.toString();
  }
};

// ----- Default credentials setup -----
if(!localStorage.getItem("ownerEmail")){
  localStorage.setItem("ownerEmail", BPhashIt.hashit("bladepeisker82@gmail.com"));
  localStorage.setItem("ownerPass", BPhashIt.hashit("blade123"));
}

// ----- Login / Logout -----
function login(){
  const eHash = BPhashIt.hashit(email.value);
  const pHash = BPhashIt.hashit(password.value);
  if(eHash === localStorage.getItem("ownerEmail") && pHash === localStorage.getItem("ownerPass")){
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("ownerPanel").classList.remove("hidden");
    renderProducts();
    renderOrders();
    showToast("Login successful!");
  } else showToast("Incorrect login");
}

function logout(){
  document.getElementById("ownerPanel").classList.add("hidden");
  document.getElementById("loginBox").classList.remove("hidden");
  email.value=""; password.value="";
  showToast("Logged out");
}

// ----- Change login -----
function changeCredentials(){
  if(newEmail.value && newPass.value){
    localStorage.setItem("ownerEmail", BPhashIt.hashit(newEmail.value));
    localStorage.setItem("ownerPass", BPhashIt.hashit(newPass.value));
    newEmail.value=""; newPass.value="";
    showToast("Credentials updated! Logout and login again.");
  } else showToast("Enter both email and password");
}

// ----- Products -----
function getProducts(){return JSON.parse(localStorage.getItem("products")||"[]");}
function saveProducts(p){localStorage.setItem("products",JSON.stringify(p));}

function saveProduct(){
  const id = prodId.value ? Number(prodId.value) : Date.now();
  const titleVal = title.value;
  const priceVal = Number(price.value);
  const typeVal = type.value;
  const downloadVal = download.value;
  const file = imageFile.files[0];

  function finalize(imageData){
    let products = getProducts();
    const existingIndex = products.findIndex(p=>p.id===id);
    const productObj = {id,title:titleVal,price:priceVal,type:typeVal,download:downloadVal,image:imageData};
    if(existingIndex>=0) products[existingIndex]=productObj;
    else products.push(productObj);
    saveProducts(products);
    renderProducts();
    resetForm();
    showToast("Product saved!");
  }

  if(file){
    const reader=new FileReader();
    reader.onload=()=>{finalize(reader.result);}
    reader.readAsDataURL(file);
  } else if(imageURL.value){
    finalize(imageURL.value);
  } else {
    showToast("Please provide image file or URL");
  }
}

function editProduct(id){
  const p=getProducts().find(x=>x.id===id);
  prodId.value=p.id;
  title.value=p.title;
  price.value=p.price;
  type.value=p.type;
  download.value=p.download;
  imageURL.value=p.image;
}

function deleteProduct(id){
  if(confirm("Delete this product?")){
    let products=getProducts();
    products=products.filter(p=>p.id!==id);
    saveProducts(products);
    renderProducts();
    showToast("Product deleted");
  }
}

function renderProducts(){
  let html="";
  getProducts().forEach(p=>{
    html+=`
      <div class="card">
        <img src="${p.image}" style="width:100%;border-radius:8px">
        <b>${p.title}</b><br>
        $${p.price}<br>
        <button onclick="editProduct(${p.id})">Edit</button>
        <button onclick="deleteProduct(${p.id})">Delete</button>
      </div>`;
  });
  document.getElementById("productsList").innerHTML=html;
}

function resetForm(){prodId.value=""; title.value=""; price.value=""; type.value="physical"; download.value=""; imageFile.value=""; imageURL.value="";}

// ----- Orders -----
function getOrders(){return JSON.parse(localStorage.getItem("orders")||"[]");}
function saveOrders(o){localStorage.setItem("orders",JSON.stringify(o));}

function renderOrders(){
  const orders = getOrders();
  let html="";
  orders.forEach((o,i)=>{
    html+=`<div class="card">
      <b>Ref: ${o.ref}</b><br>
      Paid: ${o.paid} | Refunded: ${o.refunded}<br>
      <button ${o.paid?"disabled":""} onclick="markPaid(${i})">Mark Paid</button>
      <button ${o.refunded?"disabled":""} onclick="markRefund(${i})">Mark Refunded</button>
      <button onclick="deleteOrder(${i})">Delete Order</button>
    </div>`;
  });
  document.getElementById("ordersList").innerHTML=html;
}

// ----- Live orders update -----
setInterval(renderOrders,1000);
function markPaid(i){
  let orders=getOrders();
  orders[i].paid=true;
  saveOrders(orders);
  renderOrders();
  showToast("Order marked as Paid");
}
function markRefund(i){
  let orders=getOrders();
  orders[i].refunded=true;
  saveOrders(orders);
  renderOrders();
  showToast("Order marked as Refunded");
}
function deleteOrder(i){
  if(confirm("Delete this order?")){
    let orders=getOrders();
    orders.splice(i,1);
    saveOrders(orders);
    renderOrders();
    showToast("Order deleted");
  }
}
</script>
</body>
</html>
